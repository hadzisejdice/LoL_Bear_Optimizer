<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>#1079 LoL App – Kingshot Bear Optimizer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Plotly (correct tag) -->
  <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>

  <style>
    :root{
      --bg:#0f1116;
      --panel:#1a1d24;
      --muted:#9aa4b2;
      --text:#e8eaed;
      --accent:#3b82f6;
      --accent-2:#2563eb;
      --field:#222831;
      --border:#2d3340;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:var(--bg); color:var(--text);
    }
    header{ padding:24px 16px }
    h1{ margin:0 0 16px }
    .container{ max-width:1100px; margin:auto; padding:0 16px 24px }
    .panel{
      background:var(--panel); border-radius:12px; padding:20px; margin-bottom:18px;
      border:1px solid var(--border); box-shadow:0 2px 12px rgba(0,0,0,.35);
    }
    label{ color:var(--muted); display:block; margin:8px 0 6px }
    input,select{
      width:100%; padding:12px; border-radius:8px; border:1px solid #333; background:var(--field); color:white; outline:none;
    }
    input:focus,select:focus{ border-color:var(--accent); box-shadow:0 0 0 2px #3b82f644 }
    .grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:20px; }
    .stock-grid{ gap:28px; } /* extra spacing between troop stock inputs */
    button{
      width:100%; padding:14px; margin-top:14px; background:var(--accent);
      border:0; border-radius:8px; color:white; font-size:1rem; cursor:pointer;
    }
    button:hover{ background:var(--accent-2) }
    /* small inline buttons */
    .inline-btn{
      width:auto; padding:10px 12px; margin-top:0;
    }
    #ternaryPlot{ width:100%; height:650px }
    .muted{ color:var(--muted) }
    table{ width:100%; border-collapse:collapse; margin-top:12px; background:#171b22; border-radius:8px; overflow:hidden; }
    th, td{ padding:10px 12px; border-bottom:1px solid #272d3a; text-align:right; }
    th:first-child, td:first-child{ text-align:left; }
    tr:last-child td{ border-bottom:0; }
    .pill{ display:inline-block; padding:2px 8px; background:#0f172a; border:1px solid #334155; border-radius:999px; font-size:.9rem; }
    /* Improve inventory text alignment */
    #inventoryReadout { white-space: pre-line; }  
    .recommended-box {
        box-shadow: 0 2px 8px rgba(0,0,0,.25);
    }
    .btn-green {
        background-color: #198754;
    }

    .btn-green:hover {
        background-color: #157347;
    }
  </style>
</head>
<body>

<header class="container">
  <h1>#1079 LoL App – Kingshot Bear Optimizer</h1>
</header>

<main class="container">

  <!-- ===== Stats + Tier ===== -->
  <section class="panel">
    <h2>Troop Stats Input</h2>

    <div class="grid">
      <div>
        <h3>Infantry</h3>
        <label>Attack (%)</label>
        <input id="inf_atk" type="number" step="0.1" value="481.6">
        <label>Lethality (%)</label>
        <input id="inf_let" type="number" step="0.1" value="284.4">
      </div>

      <div>
        <h3>Cavalry</h3>
        <label>Attack (%)</label>
        <input id="cav_atk" type="number" step="0.1" value="493.1">
        <label>Lethality (%)</label>
        <input id="cav_let" type="number" step="0.1" value="311.8">
      </div>

      <div>
        <h3>Archery</h3>
        <label>Attack (%)</label>
        <input id="arc_atk" type="number" step="0.1" value="508.8">
        <label>Lethality (%)</label>
        <input id="arc_let" type="number" step="0.1" value="479.7">
      </div>
    </div>

    <label for="troopTier">Troop tier</label>
    <select id="troopTier">
      <option value="T1–T6">T1–T6</option>
      <option value="T7–TG2" selected>T7–TG2</option>
      <option value="TG3–TG4">TG3–TG4</option>
    </select>

    <button id="btnPlot">Create plot chart!</button>
    <div class="muted" style="margin-top:6px">Best point uses the exact closed‑form solution.</div>
  </section>

  <!-- ===== Plot ===== -->
  <section class="panel">
    <div id="ternaryPlot"></div>
    <div id="bestReadout" class="muted" style="margin-top:10px"></div>
  </section>

  <!-- ===== Multi-formation Optimizer (Option A) ===== -->
  <section class="panel">
    <h2>Call / Join Rally ‑ Formation Optimizer</h2>

    <!-- NEW: Editable composition field used for rally -->
    <div style="display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin:6px 0 12px">
      <div style="min-width:240px; flex:1 0 240px">
        <label for="compInput">Composition to use for Rally (Inf/Cav/Arc)</label>
        <input id="compInput" type="text" inputmode="numeric" placeholder="Inf/Cav/Arc e.g. 4/10/85">
      </div>
      <div>
        <label style="visibility:hidden">.</label>
        <button id="btnUseBest" class="inline-btn btn-green">Use Recommended</button>
      </div>
      <div class="muted" id="compHint" style="min-height:1em"></div>
    </div>

    <div class="grid stock-grid">
      <div>
        <h3>Your available troops</h3>
        <label>Infantry available</label>
        <input id="stockInf" type="number" step="1" min="0" value="200653">
        <label>Cavalry available</label>
        <input id="stockCav" type="number" step="1" min="0" value="180269">
        <label>Archers available</label>
        <input id="stockArc" type="number" step="1" min="0" value="301619">
      </div>

      <div>
        <h3>Formation settings</h3>
        <label>Call rally size</label>
        <input id="rallySize" type="number" step="1" min="0" value="134850">
        <label>Join size limit</label>
        <input id="marchSize" type="number" step="1" min="1000" value="65000">
        <label># of marches you have</label>
        <input id="numFormations" type="number" step="1" min="1" value="6">

        <div class="recommended-box" style="margin-top:12px; padding:12px; background:#131821; border:1px solid #2d3340; border-radius:8px;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <div style="font-weight:600; font-size:1rem;">Recommended marches</div>
                    <div id="recommendedDisplay" class="muted" style="margin-top:4px;">…</div>
                </div>
                <button id="btnUseRecommended" class="inline-btn btn-green" style="white-space:nowrap;">Use Recommended</button>
            </div>
        </div>

        <button id="btnOptimize" style="margin-top:18px;">Optimize split</button>
      </div>
    </div>

    <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-top:14px">
      <div>
        <div class="pill">Recommended Call Rally</div>
        <div id="fractionReadout" class="muted" style="margin-top:8px"></div>
      </div>
      <div>
        <div class="pill">Inventory result</div>
        <div id="inventoryReadout" class="muted" style="margin-top:8px"></div>
      </div>
    </div>

    <div id="optTableWrap" style="margin-top:10px"></div>
  </section>

</main>

<!-- App logic -->
<script src="app.js"></script>
</body>
</html>
